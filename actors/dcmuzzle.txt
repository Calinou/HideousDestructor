// muzzle block code

actor MuzzleBlockShoot : ActionItem
{
	states
	{
	pickup:
		TNT1 A 0 A_JumpIfInventory("IsWeaponLong",1,"long")
		TNT1 A 0 A_JumpIfInventory("IsWeaponShort",1,"short")
		TNT1 A 0 A_JumpIfInventory("IsWeaponWide",1,"wide")
		TNT1 A 0 A_JumpIfInventory("IsWeaponBFG",1,"bfg")
		TNT1 A 0 A_TakeInventory("CantTurnLeft",1)
		TNT1 A 0 A_TakeInventory("CantTurnRight",1)
		TNT1 A 0 A_TakeInventory("CantTurnUp",1)
		TNT1 A 0 A_TakeInventory("CantTurnDown",1)
		stop
	short:
		TNT1 A 0 A_FireCustomMissile("MuzzleBlock",0,0)
		stop
	long:
		TNT1 A 0 A_FireCustomMissile("MuzzleBlockLong",0,0)
		stop
	wide:
		TNT1 A 0 A_FireCustomMissile("MuzzleBlockWide",0,0)
		stop
	bfg:
		TNT1 A 0 A_FireCustomMissile("MuzzleBlockBFG",0,0)
		stop
	}
}
actor MuzzleBackup : ActionItem
{
	states
	{
	pickup:
		TNT1 A 0 A_GiveInventory("IsMoving",1)
		TNT1 A 0 A_ChangeVelocity (Cos(Pitch) * -0.1, 0, Sin(Pitch) * 0.1, 1)
		stop
	}
}

actor CantTurnLeft : InventoryFlag {}
actor CantTurnRight : InventoryFlag {}
actor CantTurnUp : InventoryFlag {}
actor CantTurnDown : InventoryFlag {}
actor IsWeaponLong : InventoryFlag {}
actor IsWeaponShort : InventoryFlag {}
actor IsWeaponBFG : InventoryFlag {}
actor IsWeaponPistol : InventoryFlag {}
actor IsWeaponWide : InventoryFlag {}

actor MuzzleBlock
{
	height 2
	radius 2
	projectile
	+nointeraction +notrigger +notimefreeze
	speed 1
	states
	{
	spawn:
		TNT1 A 0
		TNT1 A 0 A_ScaleVelocity(16)
	spawn2:
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockLeft",0,-1,0,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockRight",0,1,0,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockUp",0,0,2,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockDown",0,0,-3,velx,vely,velz-abs(velz)/2,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		stop
	}
}
actor MuzzleBlockBFG : MuzzleBlock
{
	states
	{
	spawn:
		TNT1 A 0
		TNT1 A 0 A_ScaleVelocity(18)
	spawn2:
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockLeft",0,-5,0,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockRight",0,5,0,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockUp",0,0,4,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockDown",0,0,-6,velx,vely,velz-abs(velz)/2,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		stop
	}
}
actor MuzzleBlockWide : MuzzleBlock
{
	states
	{
	spawn:
		TNT1 A 0
		TNT1 A 0 A_ScaleVelocity(18)
	spawn2:
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockLeft",0,-6,0,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockRight",0,6,0,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockUp",0,0,3,velx,vely,velz,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		TNT1 A 0 A_SpawnItemEx("MuzzleBlockDown",0,0,-3,velx,vely,velz-abs(velz)/2,0,SXF_NOCHECKPOSITION|SXF_ABSOLUTEMOMENTUM|SXF_TRANSFERPOINTERS)
		stop
	}
}
actor MuzzleBlockLong : MuzzleBlock
{
	states
	{
	spawn:
		TNT1 A 0
		TNT1 A 0 A_ScaleVelocity(20)
		goto spawn2
	}
}
actor MuzzleBlockLeft : FastProjectile
{
	height 2 radius 2 +notrigger +notimefreeze
	renderstyle none
	states
	{
	spawn:
		TNT1 A 1
		TNT1 A 0 A_TakeFromTarget("CantTurnLeft",1)
		stop
	death:
		TNT1 A 0 A_GiveToTarget("IsSupported",1)
		TNT1 A 0 A_JumpIfInTargetInventory("CantTurnLeft",1,2)
		TNT1 A 0 A_PlaySound("weapons/rifleclick2",CHAN_BODY,0.6)
		BAL1 A 4 A_GiveToTarget("CantTurnLeft",1)
		stop
	}
}
actor MuzzleBlockRight : MuzzleBlockLeft
{
	states
	{
	spawn:
		TNT1 A 1
		TNT1 A 0 A_TakeFromTarget("CantTurnRight",1)
		stop
	death:
		TNT1 A 0 A_GiveToTarget("IsSupported",1)
		TNT1 A 0 A_JumpIfInTargetInventory("CantTurnRight",1,2)
		TNT1 A 0 A_PlaySound("weapons/rifleclick2",CHAN_BODY,0.6)
		BAL1 A 4 A_GiveToTarget("CantTurnRight",1)
		stop
	}
}
actor MuzzleBlockUp : MuzzleBlockLeft
{
	states
	{
	spawn:
		TNT1 A 1
		TNT1 A 0 A_TakeFromTarget("CantTurnUp",1)
		stop
	death:
		TNT1 A 0 A_GiveToTarget("IsSupported",1)
		TNT1 A 0 A_JumpIfInTargetInventory("CantTurnUp",1,2)
		TNT1 A 0 A_PlaySound("weapons/rifleclick2",CHAN_BODY,0.6)
		BAL1 A 4 A_GiveToTarget("CantTurnUp",1)
		stop
	}
}
actor MuzzleBlockDown : MuzzleBlockLeft
{
	states
	{
	spawn:
		TNT1 A 1
		TNT1 A 0 A_TakeFromTarget("CantTurnDown",1)
		stop
	death:
		TNT1 A 0 A_GiveToTarget("IsSupported",1)
		TNT1 A 0 A_JumpIfInTargetInventory("CantTurnDown",1,2)
		TNT1 A 0 A_PlaySound("weapons/rifleclick2",CHAN_BODY,0.6)
		BAL1 A 4 A_GiveToTarget("CantTurnDown",1)
		stop
	}
}

